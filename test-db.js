const Database = require("better-sqlite3"); const path = require("path"); const dbPath = path.join(process.cwd(), "data", "database", "test.sqlite"); const db = new Database(dbPath); console.log("Testing database operations..."); db.exec("CREATE TABLE IF NOT EXISTS pairs (id TEXT PRIMARY KEY, symbol TEXT NOT NULL UNIQUE, rank INTEGER, market_cap REAL, volume REAL, price REAL, source TEXT NOT NULL, fetched_at INTEGER NOT NULL DEFAULT (strftime(\"%s\", \"now\")), is_active INTEGER NOT NULL DEFAULT 1)"); console.log("Tables created successfully"); const insertPair = db.prepare("INSERT INTO pairs (id, symbol, rank, market_cap, volume, price, source, fetched_at, is_active) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)"); const pairId = "test-" + Date.now(); const result = insertPair.run(pairId, "BTC", 1, 1000000000000, 50000000000, 50000, "test", Math.floor(Date.now() / 1000), 1); console.log("Inserted pair:", result); const getPairs = db.prepare("SELECT * FROM pairs WHERE is_active = 1"); const pairs = getPairs.all(); console.log("Found pairs:", pairs); db.close(); console.log("Database test completed successfully");
